<p>In SQL, a <span style="font-family: terminal, monospace;">JOIN</span> clause combines columns from one or more tables, allowing us to retrieve data stored in different tables by using values common to each. Unlike some distributed databases, CrateDB fully supports joins. In this video, you'll see how to join data from our Chicago <span style="font-family: terminal, monospace;">taxis</span> and <span style="font-family: terminal, monospace;">taxi_rides</span> tables.</p>
<p>Let's get started. This the schema for our <span style="font-family: terminal, monospace;">taxis</span> table. This table contains details about the vehicles comprising Chicago's taxi fleet, for example, the make, model and colour of each one. Each vehicle is assigned a unique <span style="font-family: terminal, monospace;">vehicleid</span>.</p>
<p>And here's the schema for our <span style="font-family: terminal, monospace;">taxi_rides</span> table. This table holds details of each taxi ride taken in April 2024. The <span style="font-family: terminal, monospace;">vehicleid</span> in this table refers to the vehicle that performed the ride. If we know the <span style="font-family: terminal, monospace;">vehicleid</span> for a ride, we can find the details of the taxi that performed the ride in the taxis table, and we can use a<span style="font-family: terminal, monospace;"> vehicleid</span> from the <span style="font-family: terminal, monospace;">taxis</span> table to query the <span style="font-family: terminal, monospace;">taxi_rides</span> table. This query retrieves some of the details for Kia Soul taxis. There are eight of these vehicles in Chicago's taxi fleet. Using the <span style="font-family: terminal, monospace;">vehicleid</span> of one of these taxis, we can see the details of the rides performed by that vehicle. What if we wanted to show details from the <span style="font-family: terminal, monospace;">taxis</span> table in the result set for this sort of query? This is where we need to use a join.</p>
<p>This query retrieves the start time of the most recent taxi ride performed by each of our Kia Soul taxis. We want to retrieve the <span style="font-family: terminal, monospace;">vehicleid</span>, <span style="font-family: terminal, monospace;">make</span>, <span style="font-family: terminal, monospace;">model</span> and latest start time for each. The data is spread over two tables, <span style="font-family: terminal, monospace;">taxis</span> and <span style="font-family: terminal, monospace;">taxi_rides</span>. We use the <span style="font-family: terminal, monospace;">t</span> or <span style="font-family: terminal, monospace;">r</span> prefix when referencing the <span style="font-family: terminal, monospace;">vehicleid</span> column, as this column is common to both tables in the <span style="font-family: terminal, monospace;">WHERE</span> clause, we're joining the two tables by specifying that for each result, the <span style="font-family: terminal, monospace;">vehicleid</span> in the <span style="font-family: terminal, monospace;">taxis</span> table must match the <span style="font-family: terminal, monospace;">vehicleid</span> in the <span style="font-family: terminal, monospace;">taxi_rides</span> table. This query returns a result set containing data from both tables. <span style="font-family: terminal, monospace;">vehicleid</span> and <span style="font-family: terminal, monospace;">ridestart</span> come from data in the <span style="font-family: terminal, monospace;">taxi_rides</span> table, while <span style="font-family: terminal, monospace;">make</span> and <span style="font-family: terminal, monospace;">model</span> come from data in the <span style="font-family: terminal, monospace;">taxis</span> table.</p>
<p>Here's the same query but expressed differently. This time we're using a <span style="font-family: terminal, monospace;">JOIN</span> clause to specify how the rows in the two tables relate to each other. Running the query produces the same result as before. This query returns the number of trips made by each of our Kia Soul Taxis where the trip originated in community area 76 O'Hare and ended in community area 32: The Loop. Running this query returns three results. Each result is for a vehicle which had matching taxi rides. Recall that there are 8 Kia Soul taxis in Chicago's fleet. So why do we only have three results? This is because we're performing what's called an "inner join" here. With an "inner join", only records that have a match in both tables are returned, as five of our Kia Soul taxis didn't perform a trip that met the criteria. There are no matching results in the <span style="font-family: terminal, monospace;">taxi_rides</span> table for them, and they are omitted from the result set.</p>
<p>What if we wanted to produce a report including all the Kia Soul taxis, even those that didn't perform any qualifying trips? For that, we need an <span style="font-family: terminal, monospace;">OUTER JOIN</span>. In this case, we want a <span style="font-family: terminal, monospace;">LEFT JOIN</span>. We want to return all of the rows from the left hand table <span style="font-family: terminal, monospace;">taxis</span> even if there aren't any matching records in the <span style="font-family: terminal, monospace;">taxi_rides</span> table. We achieved that by specifying <span style="font-family: terminal, monospace;">LEFT JOIN</span> here. When we run this query, we see that there are now 8 rows in the result set, one for each of the Kia Soul taxis. This includes the five taxis that didn't perform any qualifying rides.</p>
<p>In this video you saw how to perform queries with joins in CrateDB. CrateDB supports inner, outer and cross joins. For more information, consult the documentation online.</p>